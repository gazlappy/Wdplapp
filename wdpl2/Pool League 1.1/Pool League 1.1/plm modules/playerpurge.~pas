unit playerpurge;

interface

uses Windows, SysUtils, Classes, Graphics, Forms, Controls, StdCtrls, 
  Buttons, ExtCtrls, Db, DBTables, Dialogs;

type
  TPPForm = class(TForm)
    OKBtn: TButton;
    CancelBtn: TButton;
    Label1: TLabel;
    ListBox1: TListBox;
    PlayerQuery: TQuery;
    PlayerQueryPlayerName: TStringField;
    PlayerQueryPlayerTeam: TIntegerField;
    PlayerQueryPlayed: TIntegerField;
    PlayerQueryTeamName: TStringField;
    PlayerQueryWithdrawn: TBooleanField;
    procedure FormShow(Sender: TObject);
    procedure OKBtnClick(Sender: TObject);
    procedure CancelBtnClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  PPForm: TPPForm;

implementation

uses datamodule;

{$R *.DFM}

procedure TPPForm.FormShow(Sender: TObject);
var text: String;
begin
  PlayerQuery.Close;
  PlayerQuery.Open;
  ListBox1.Items.Clear;
  while not PlayerQuery.EOF do
  begin
    if not PlayerQueryWithdrawn.Value then
    begin
      text := PlayerQueryPlayerName.Value + ' (';
      text := text + PlayerQueryTeamName.Value + ')';
      ListBox1.Items.Add(text);
    end;
    PlayerQuery.Next;
  end;
  if ListBox1.Items.Count = 0 then
  begin
    MessageDlg('No players with zero frames played.', mtWarning, [mbOK], 0);
    ModalResult := mrCancel;
    Abort;
    PPForm.Free;
  end;
end;

procedure TPPForm.OKBtnClick(Sender: TObject);
begin
  PlayerQuery.Close;
  PlayerQuery.Open;
  while not PlayerQuery.EOF do
  begin
    PlayerQuery.Delete;
  end;
  MessageDlg(IntToStr(ListBox1.Items.Count) + ' players deleted.', mtInformation, [mbOK], 0);
  DM1.AllPlayerLookUp.Refresh;
  Close;
end;

procedure TPPForm.CancelBtnClick(Sender: TObject);
begin
  Close;
end;

end.
