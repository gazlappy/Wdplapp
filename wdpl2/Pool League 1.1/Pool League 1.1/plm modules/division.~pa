unit Division;

interface

uses WinTypes, WinProcs, Classes, Graphics, Forms, Controls, Buttons,
  StdCtrls, ExtCtrls, DBCtrls, Mask, DB, DBTables, Grids, DBGrids,
  Dialogs, SysUtils;

type
  TDivisionsForm = class(TForm)
    Bevel1: TBevel;
    Division: TTable;
    DivisionSource: TDataSource;
    DBGrid1: TDBGrid;
    Close: TBitBtn;
    Button1: TButton;
    DivisionAbbreviated: TStringField;
    DivisionFullDivisionName: TStringField;
    Delete: TButton;
    DeleteQuery: TQuery;
    procedure FormCreate(Sender: TObject);
    procedure CloseClick(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure DeleteClick(Sender: TObject);
    procedure DBGrid1Exit(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
  private
    { Private declarations }
  public
    oldabb: String; // old abbreviated name
    { Public declarations }
  end;

var
  DivisionsForm: TDivisionsForm;

implementation

uses Divins, Main;

{$R *.DFM}

procedure TDivisionsForm.FormCreate(Sender: TObject);
begin
  Division.Open;
end;

procedure TDivisionsForm.CloseClick(Sender: TObject);
begin
  Division.Post;
  Division.Refresh;
  Division.Close;
end;

procedure TDivisionsForm.Button1Click(Sender: TObject);
begin
  DivisionsForm.Enabled := False;
  Application.CreateForm(TDivisionInsert, DivisionInsert);
end;

procedure TDivisionsForm.DeleteClick(Sender: TObject);
var
  Key: string;
begin
  Key := DBGrid1.Fields[0].AsString;
  if MessageDlg(Format('Delete "%S" from the Division table?', [Key]),
    mtConfirmation, mbOKCancel, 0) = mrOK then
  begin
    DeleteQuery.Prepare;
    DeleteQuery.Params[0].AsString := Key;
    DeleteQuery.ExecSQL;
    Division.Refresh;
  end;
end;

procedure TDivisionsForm.DBGrid1Exit(Sender: TObject);
begin
if Division.State in [dsEdit,dsInsert] then
  Division.Post;
end;

procedure TDivisionsForm.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
Action := caFree;
end;

end.
